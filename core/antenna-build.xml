<project name="UstadMobileCore" default="package" basedir=".">
    <description>Core Java bits of UstadMobile .</description>


    <condition property="build.properties.filename"
        value="ustadmobilecore-build.properties"
        else="ustadmobilecore-build.default.properties">

        <resourceexists>
            <file file="build-release.properties"/>
        </resourceexists>
    </condition>

    <property file="ustadmobilecore-build.properties"/>

    <condition property="classpath.antenna"
               value="${classpath}"
               else="${antenna.home}">
        <available resource="antenna.properties"/>
    </condition>

    <taskdef classpath="${classpath.antenna}" resource="antenna.properties"/>

    <!-- properties to make it build outside netbeans -->
    <property name="src.dir" value="./src/"/>

    <property name="wtk.cldc.version" value="1.1"/>
    <property name="wtk.midp.version" value="2.1"/>
 
    <path id="bootclasspath.ref">
        <fileset dir="${wtk.home}/lib" >
            <include name="*.jar" />
        </fileset>
	<fileset dir="./lib/">
	    <include name="kxml2-min-2.3.0.jar" />
	</fileset>
    </path>

    <target name="clean">
        <delete dir="classes" />
        <delete dir="dist" />
    </target>
    <target name="init">
        <mkdir dir="classes/" />
        <mkdir dir="dist/" />
    </target>

    <target name="build" depends="init">
       <wtkbuild
            srcdir="${src}" 
            destdir="classes/" 
            encoding="UTF-8" 
            source="1.3" 
            includeAntRuntime="false" >
            <bootclasspath refid="bootclasspath.ref" />
        </wtkbuild>

    </target>
    <target name="create-jad" depends="init">
        <wtkjad jadfile="dist/UstadMobileCore.jad" name="UstadMobileCore" vendor="UstadMobile" version="0.1" encoding="UTF-8">
        </wtkjad>
    </target>
    <target name="package" depends="build, create-jad">
        <wtkpackage preverify="true" jarfile="dist/UstadMobileCore.jar" jadfile="dist/UstadMobileCore.jad">
            <bootclasspath refid="bootclasspath.ref" />

            <fileset dir="classes" />
        </wtkpackage>
    </target>
    <target name="getlibs">
        <mkdir dir="${lib.dir}"/>
        <mkdir dir="${lib.dir}/downloads"/>

        <get dest="${lib.dir}/downloads">

            <!-- kXML JAR from UstadMobile.com -->
            <url url="http://www.ustadmobile.com/build-dep/kxml2-min-2.3.0.jar"/>

            <!-- ProGuard 4.10 zipped binary from UstadMobile.com -->
            <url url="http://www.ustadmobile.com/build-dep/proguard4.10.zip"/>

	    <!-- Prebop preprocessor -->
            <url url="http://www.ustadmobile.com/build-dep/com.objfac.ant.preprocess_0.9.1.zip"/>
        </get>

        <unzip dest="${lib.dir}">
            <fileset dir="${lib.dir}/downloads">
                <include name="*.zip"/>
            </fileset>
        </unzip>

        <copy todir="${lib.dir}">
            <fileset dir="${lib.dir}/downloads">
                <include name="*.jar"/>
            </fileset>
        </copy>
    </target>
</project>

